
let print_string = (s: string) => 
{
 	var handle = GetStdHandle(-11);
 	WriteFile(handle, s.data, s.length, nullptr, nullptr);
}


let wait_for_key = () => 
{
	print_string("Press enter to continue...");
	var handle = GetStdHandle(-10);
	var s = "123456789012345678901234567890xx";
	ReadFile(handle, s.data, s.length, nullptr, nullptr);
}


var ra = -2.0;
var rb = 1.0;
var ia = -1.0;
var ib = 1.0;

var maxx = 60.0;
var maxy = maxx * 0.5 * (ib  - ia) / (rb - ra) + 1.0;

var full = "#";
var half = "x";
var empt = ".";

var deltay = (ib - ia) / maxy;
var deltax = (rb - ra) / maxx;

for (var cy = ia; cy < ib; cy += deltay)
{
	for (var cx = ra; cx < rb; cx += deltax)
	{
		var x = 0.0;
		var y = 0.0;
		var iter = 0;
		for (; iter < 256; ++iter)
		{
			var x2 = x * x;
			var y2 = y * y;
			// stop iteration when length of Z > 2
			if (x2 + y2 > 4.0)
			{
				break;
			}
			var twoxy = 2.0 * x * y;
			x = x2 - y2 + cx;
			y = twoxy + cy;
		}
		if (iter < 25)
		{
			print_string(empt);
		}
		elif (iter < 200)
		{
			print_string(half);
		}
		else
		{
			print_string(full);
		}

	}
	print_string("\n");
}
wait_for_key();
